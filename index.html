<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta property="og:title" content="TRX Workout Guide">
    <meta property="og:description" content="Interactive TRX workout guide with audio cues">
    <meta property="og:type" content="website">
    <title>TRX Workout Guide</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.0/papaparse.min.js"></script>
</head>
<body class="bg-gray-100">
    <div id="app" class="container mx-auto px-4 py-8">
        <!-- Header -->
        <header class="text-center mb-8">
            <h1 class="text-4xl font-bold mb-4">TRX Workout Guide</h1>
        </header>

        <!-- Program Selection -->
        <div class="mb-8">
            <select id="programSelect" class="w-full p-3 border rounded-lg">
                <option value="">Select Program</option>
                <option value="muscle-builder">Muscle Builder (Intermediate)</option>
                <option value="full-body">Full Body Athlete (Advanced)</option>
            </select>
        </div>

        <!-- Week Selection -->
        <div class="mb-8">
            <select id="weekSelect" class="w-full p-3 border rounded-lg" disabled>
                <option value="">Select Week</option>
            </select>
        </div>

        <!-- Day Selection -->
        <div class="mb-8">
            <select id="daySelect" class="w-full p-3 border rounded-lg" disabled>
                <option value="">Select Day</option>
            </select>
        </div>

        <!-- Current Exercise Display -->
        <div id="exerciseDisplay" class="bg-white p-6 rounded-lg shadow-md mb-8 hidden">
            <h2 class="text-2xl font-bold mb-4">Current Exercise</h2>
            <div class="exercise-info">
                <h3 id="exerciseName" class="text-xl font-semibold"></h3>
                <p id="exerciseNotes" class="text-gray-600 mb-4"></p>
                <div class="grid grid-cols-2 gap-4 mb-4">
                    <div>
                        <span class="font-bold">Sets:</span>
                        <span id="exerciseSets"></span>
                    </div>
                    <div>
                        <span class="font-bold">Reps:</span>
                        <span id="exerciseReps"></span>
                    </div>
                    <div>
                        <span class="font-bold">Tempo:</span>
                        <span id="exerciseTempo"></span>
                    </div>
                    <div>
                        <span class="font-bold">Rest:</span>
                        <span id="exerciseRest"></span>
                    </div>
                </div>
            </div>
            <div class="flex space-x-4">
                <button id="startExercise" class="bg-green-500 text-white px-6 py-2 rounded-lg hover:bg-green-600">
                    Start Exercise
                </button>
                <button id="stopExercise" class="bg-red-500 text-white px-6 py-2 rounded-lg hover:bg-red-600">
                    Stop
                </button>
            </div>
        </div>

        <!-- Exercise List -->
        <div id="exerciseList" class="bg-white p-6 rounded-lg shadow-md">
            <h2 class="text-2xl font-bold mb-4">Workout Plan</h2>
            <div id="exerciseItems" class="space-y-4">
                <!-- Exercises will be populated here -->
            </div>
        </div>

        <!-- CSV Upload Section -->
        <div class="fixed bottom-4 right-4 bg-white p-4 rounded-lg shadow-lg">
            <input type="file" id="csvFile" accept=".csv" class="mb-2">
            <button id="uploadCSV" class="w-full bg-blue-500 text-white px-6 py-2 rounded-lg hover:bg-blue-600">
                Upload to Database
            </button>
            <div id="uploadStatus" class="text-sm mt-2"></div>
        </div>
    </div>

    <!-- Firebase Scripts -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.2.0/firebase-app.js";
        import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/11.2.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyD6VXHNZ24qJ2YaScWFgbnHXtl7uIaS4u8",
            authDomain: "workout-9135b.firebaseapp.com",
            projectId: "workout-9135b",
            storageBucket: "workout-9135b.firebasestorage.app",
            messagingSenderId: "801718631070",
            appId: "1:801718631070:web:eff3613dbf8444ac92598f"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // CSV Upload Handler
        document.getElementById('uploadCSV').addEventListener('click', async () => {
            const fileInput = document.getElementById('csvFile');
            const statusDiv = document.getElementById('uploadStatus');
            const file = fileInput.files[0];

            if (!file) {
                statusDiv.textContent = 'Please select a CSV file first';
                return;
            }

            statusDiv.textContent = 'Uploading...';

            Papa.parse(file, {
                header: true,
                complete: async (results) => {
                    try {
                        const workouts = {};
                        
                        // Group exercises by program, block, week, day
                        results.data.forEach(row => {
                            if (!row.program || !row.block || !row.week || !row.day) return;
                            
                            const key = `${row.program}-b${row.block}-w${row.week}-d${row.day}`;
                            if (!workouts[key]) {
                                workouts[key] = {
                                    program: row.program,
                                    block: parseInt(row.block),
                                    week: parseInt(row.week),
                                    day: parseInt(row.day),
                                    focus: row.focus,
                                    exercises: []
                                };
                            }

                            workouts[key].exercises.push({
                                name: row.exercise_name,
                                sets: row.sets,
                                reps: row.reps,
                                RPE: parseInt(row.RPE),
                                tempo: row.tempo,
                                rest: row.rest,
                                notes: row.notes
                            });
                        });

                        // Upload to Firestore
                        for (const workout of Object.values(workouts)) {
                            await addDoc(collection(db, "workouts"), workout);
                        }

                        statusDiv.textContent = 'Upload complete!';
                        setTimeout(() => {
                            statusDiv.textContent = '';
                        }, 3000);

                    } catch (error) {
                        console.error("Error:", error);
                        statusDiv.textContent = 'Error uploading data';
                    }
                },
                error: (error) => {
                    console.error("Error:", error);
                    statusDiv.textContent = 'Error parsing CSV';
                }
            });
        });
    </script>

    <!-- App Scripts -->
    <script type="module" src="./js/database.js"></script>
    <script type="module" src="./js/audio.js"></script>
    <script type="module" src="./js/workouts.js"></script>
    <script type="module" src="./js/app.js"></script>
</body>
</html>
